<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<title>Night Duty Allowance Claim Form</title>
<meta name="viewport" content="width=device-width,initial-scale=1" />
<style>

/* ---------------------------------------------------
   FINAL A4 + CENTER + EQUAL MARGINS + 70% SCALE
   --------------------------------------------------- */
@page {
    size: A4;
    margin: 10mm;                     /* equal margins */
}

html, body {
    margin: 0;
    padding: 0;
    background: #fff;
}

body {
    width: 210mm;                     /* Full A4 width */
    transform: scale(0.70);           /* YOUR REQUIRED SCALE */
    transform-origin: top center;     
    margin-left: auto;                 /* Center page */
    margin-right: auto;
}

/* ---------------------------------------------------
   ORIGINAL LAYOUT (UNCHANGED)
   --------------------------------------------------- */

.page { width:760px; margin:0 auto; padding:12px; }

.logo { text-align:center; margin-bottom:6px; }
.logo img { width:85px; height:auto; }

h1 { text-align:center; font-size:20px; margin:4px 0; }
.sub { text-align:center; font-size:11.5px; }

table { border-collapse:collapse; width:100%; table-layout:fixed; }
th, td { border:1px solid #000; padding:6px; font-size:12px; text-align:center; }

.meta th:nth-child(1), .meta td:nth-child(1) { width:22%; }
.meta th:nth-child(2), .meta td:nth-child(2) { width:12%; }
.meta th:nth-child(3), .meta td:nth-child(3) { width:16%; }
.meta th:nth-child(4), .meta td:nth-child(4) { width:16%; }
.meta th:nth-child(5), .meta td:nth-child(5) { width:12%; }
.meta th:nth-child(6), .meta td:nth-child(6) { width:22%; }

.duty th { font-size:12px; font-weight:bold; }
.duty td { height:26px; }

.cert-title { text-align:center; font-weight:bold; text-decoration:underline; font-size:13px; margin-top:18px; }
.cert-intro { font-size:10.5px; margin-top:6px; }

.sig-employee { float:right; width:40%; text-align:center; font-size:10.5px; margin-top:12px; }
.sigline { margin-top:10px; border-top:1px solid #000; width:160px; margin:10px auto 0 auto; }

.cert-points { margin-top:12px; font-size:10.5px; line-height:1.25; }

.manager-row { margin-top:16px; font-size:10.5px; }
.manager-left { float:left; width:48%; }
.manager-right { float:right; width:48%; text-align:right; }

.spacer { height:12px; clear:both; }

</style>
</head>

<body>
<div class="page">

  <div class="logo">
      <img src="jaipur_logo.png" alt="JMRC Logo">
  </div>

  <h1>Night Duty Allowance Claim Form</h1>
  <div class="sub">(As per Rule 9.2 (f) of JMRC Recruitment Rules) 2012<br>(To be submitted in Duplicate)</div>

  <table class="meta" style="margin-top:12px;">
    <tr>
      <th>Name of Employee</th>
      <th>Emp. ID</th>
      <th>Designation & Deptt.</th>
      <th>Date of Confirmation</th>
      <th>Month :-</th>
      <th>Pay of One day for the month (Basic+DA)</th>
    </tr>
    <tr>
      <td id="empName"></td>
      <td id="empId"></td>
      <td>SC/TO</td>
      <td id="confirmDate"></td>
      <td id="month"></td>
      <td id="payOneDay"></td>
    </tr>
  </table>

  <table class="duty" style="margin-top:14px;">
    <thead>
      <tr>
        <th>S.No.</th>
        <th>Date</th>
        <th>Sign On Time</th>
        <th>Sign Off Time</th>
        <th>Night Duty Hours<br>(2200 to 0600)</th>
        <th>Duty Place/Station</th>
        <th>Remarks</th>
      </tr>
    </thead>
    <tbody id="dutyBody"></tbody>
  </table>

  <div class="cert-title">Certificate</div>

  <div class="cert-intro">
    It is certify that the Night Duty Allowance, as claimed above is correct &amp; due to me,
    and this claim has not been submitted earlier.
  </div>

  <div style="width:100%;">
    <div class="sig-employee">
      <b>Signature of the employee</b>
      <div class="sigline"></div>
    </div>
    <div style="clear:both;"></div>
  </div>

  <div class="cert-points">
    <p>
      1. As per sign on and sign off duty record of the employee Mr./Mrs.
      <span id="certName"></span><br>
      SC/TO, Deptt.–OPERATIONS, Duty Place...................
      the above detail submitted for the Night Duty Allowance is certified and due to the above employee.
    </p>

    <p>
      2. Total Night Duty Allowance payable to him / her is Rs. <b id="totalNDA"></b>/- 
    </p>
  </div>

  <div class="manager-row">
    <div class="manager-left"><b>Sanctioned (As per clause E18 of SOP, JMRC) by:</b></div>
    <div class="manager-right"><b>Name & Signature of Concerned Manager</b></div>
    <div style="clear:both;"></div>
  </div>

  <div class="spacer"></div>

  <div style="font-size:10.5px; margin-bottom:12px;"><b>Concerned ED/General Manager (Sign & Seal):</b></div>

  <div class="spacer"></div>

  <div style="font-size:10.5px;"><b>Forward to:</b> GM(Finance), JMRC for making payment</div>

</div>

<script>
(function(){

  let raw = localStorage.getItem("dutyTrackerData");
  let data = raw ? JSON.parse(raw) : {};

  let printData = data.printData || {};
  let profile   = printData.profile || {};
  let records   = printData.records || {};
  let payData   = printData.pay || {};

  let selectedMonth = localStorage.getItem("selectedPrintMonth") || "";
  let monthKey = selectedMonth.slice(-2);

  empName.textContent      = profile.name || "";
  empId.textContent        = profile.empId || "";
  confirmDate.textContent  = profile.confirmDate || "";
  month.textContent        = selectedMonth;
  certName.textContent     = profile.name || "";

  let oneDayPay = payData[monthKey] ? Number(payData[monthKey]) : 0;
  payOneDay.textContent = oneDayPay.toFixed(2);

  let dates = Object.keys(records)
    .filter(d => d.startsWith(selectedMonth))
    .sort()
    .filter(d => Number(records[d].nightDutyHours || 0) > 0);

  const tbody = document.getElementById("dutyBody");
  
  let totalHours = 0;
  let sNo = 0;

  dates.forEach(date => {
      let r = records[date];
      let hrs = Number(r.nightDutyHours || 0);

      sNo++;
      totalHours += hrs;

      let tr = document.createElement("tr");
      tr.innerHTML = `
          <td>${sNo}</td>
          <td>${date}</td>
          <td>${r.signOnTime || ""}</td>
          <td>${r.signOffTime || ""}</td>
          <td>${hrs}</td>
          <td>${r.signOnPlace || ""}</td>
          <td></td>
      `;
      tbody.appendChild(tr);
  });

  let eq  = totalHours / 24;
  let nda = eq * oneDayPay;

  tbody.innerHTML += `
    <tr>
      <td>(A)</td>
      <td colspan="5" style="text-align:left;">TOTAL Night Hours</td>
      <td>${totalHours}</td>
    </tr>
    <tr>
      <td>(B)</td>
      <td colspan="5" style="text-align:left;">Equivalent Night Duty Day = A/24</td>
      <td>${eq.toFixed(2)}</td>
    </tr>
    <tr>
      <td>(C)</td>
      <td colspan="5" style="text-align:left;">NDA Claimed (Rs.) = B × One Day Pay</td>
      <td>${nda.toFixed(2)}</td>
    </tr>
  `;

  totalNDA.textContent = nda.toFixed(2);

  window.onload = () => setTimeout(()=>window.print(), 500);

})();
</script>

</body>
</html>